<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">


    <meta name="author" content="yaming042">



    <meta name="keywords" content="bug,"/>



    <meta name="description" content="今天闲来无事，忽然想起了前天在开发功能时遇到的一个问题，具体情况就是我渲染了一个邮箱列表，列表支持修改邮箱，但是发现每次改完邮箱后input框就会失去焦点，按理说input是不会失去焦点的，但bug就此发生了。



需要渲染的邮箱列表数据格式 ['xiaoming@163.com','lie..."/>


<meta name="Robots" content="all">


    <title>一个改变的key引发的问题 | Coding_用代码记录点滴，Happy_用快乐享受生活</title>


<link rel="icon" href="/images/favicon.ico">

<link rel="stylesheet" href="/css/style.css">


<script src="/js/jquery.min.js"></script>


<script src="/js/av.min.js"></script>


<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0bb2321117b8ad1f07d1fca35aa1199a";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>
<meta name="generator" content="Hexo 5.4.0"></head>
<body>

    <div class="main-container">
        <div class="web-header">
    <div class="logo">TYM042</div>

    <div class="web-menu">
        <div class="menu-list clearfix">
            
                <div class="menu-item">
                    <h2>
                        <a 
                            class="menu-item-link" 
                            href="/"
                            
                        >
                            首页
                        </a>
                    </h2>
                    <span>Home</span>
                </div>
            
                <div class="menu-item">
                    <h2>
                        <a 
                            class="menu-item-link" 
                            href="/categories/博文/"
                            
                        >
                            博文
                        </a>
                    </h2>
                    <span>Blog</span>
                </div>
            
                <div class="menu-item">
                    <h2>
                        <a 
                            class="menu-item-link" 
                            href="/categories/笔记/"
                            
                        >
                            笔记
                        </a>
                    </h2>
                    <span>Notes</span>
                </div>
            
        </div>
    </div>
</div>
<div class="banner">
    <img src="/images/banner.jpeg" alt="">
</div>
        <div class="container-box">
            <div class="container-body">
                <div class="web-article">
    <div class="web-article-container">
        <div class="web-article-view">
            <div class="article-baseinfo">
                <h2>一个改变的key引发的问题</h2>
                <div class="other-info">
                    <span>发布时间：2021-04-04</span>
                    <span>作者：yaming042</span>
                    
                        <span>
                            阅读量：<i id="/20210404/20210404/" class="leancloud_visitors" data-flag-title="一个改变的key引发的问题">-</i> 次
                        </span>
                    
                    
                    <span>本文字数：3.2k</span>
                    <span>阅读时长 ≈ 3 分钟</span>
                </div>
            </div>
            <p>今天闲来无事，忽然想起了前天在开发功能时遇到的一个问题，具体情况就是我渲染了一个邮箱列表，列表支持修改邮箱，但是发现每次改完邮箱后input框就会失去焦点，按理说input是不会失去焦点的，但bug就此发生了。</p>
<hr>
<p><img src="/20210404/20210404/email.png" alt="邮件列表"></p>
<hr>
<p>需要渲染的邮箱列表数据格式 <code>['xiaoming@163.com','lier@163.com']</code>，渲染的列表支持修改，代码如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">let</span> &#123; emails &#125; = <span class="hljs-built_in">this</span>.state;<br><br>    <span class="hljs-keyword">return</span> (<br>        &lt;div className=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>            &#123;<br>                (emails || []).map(<span class="hljs-function">(<span class="hljs-params">email, index</span>) =&gt;</span> &#123;<br>                    <span class="hljs-keyword">return</span> (<br>                        &lt;div className=<span class="hljs-string">&quot;email-row&quot;</span> key=&#123; email &#125;&gt;<br>                            &lt;input <br>                                type=<span class="hljs-string">&quot;text&quot;</span> <br>                                value=&#123; email &#125; <br>                                onChange=&#123;<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>                                    emails[index] = (e.target.value || <span class="hljs-string">&#x27;&#x27;</span>).trim();<br>                                    <span class="hljs-built_in">this</span>.setState(&#123;<br>                                        emails: emails)<br>                                    &#125;);<br>                                &#125;&#125;    <br>                            /&gt;<br>                        &lt;/div&gt;<br>                    );<br>                &#125;)<br>            &#125;<br>        &lt;/div&gt;<br>    );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>看完上面是否有发现问题。大体看上去没啥问题，但是在页面上实际测过后你会发现一个bug，每次敲击完键盘，input输入框会失去焦点，那么为什么会发生这种bug呢，其实你回想下react的渲染流程应该就会发现问题。<br><strong>先说原因：</strong>因为你每次change后email发生了改变，也就是说，你在渲染列表的时候，列表的 <code>key</code> 发生了改变，此时再次渲染，原来的dom已经被干掉换成新的dom了，只是看起来还是原来的那个input；<br><strong>再说处理办法：</strong>慎重定义 <code>key</code> 的值</p>

        </div>
    </div>
    
</div>
            </div>
            
                <div class="aside">
    
        <div class="web-sidebar-box box-item">
    <div class="sidebar-title">
        <h2>关于我</h2>
    </div>
    <div class="tag-list">
        目前网站处于前期调整阶段
    </div>
</div>
    
        
    <div class="web-sidebar-box box-item">
        <div class="sidebar-title">
            <h2>最新文章</h2>
        </div>
        <div class="latest-list">
            <ul class="item-box">
                
                    
                        <li>
                            <a href="/20210404/20210404/">
                                1. 一个改变的key引发的问题
                            </a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/20210331/20210331/">
                                2. js 数据类型检测
                            </a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/20210328/2021328/">
                                3. 国内github访问速度慢怎么解决
                            </a>
                        </li>
                    
                
            </ul>
        </div>
    </div>

    
</div>
            
            </div>
        <div class="web-footer">
    <h2 class="friend-state">友情声明</h2>
    <div class="coperation">
        <p>本网站部分资料来源于网络，如有任何问题可联系站主解决</p>
    </div>
    <div class="copyright">
        <span>Copyright &copy; 2021</span>
        <span class="dotted">|</span>
        <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span>
        <span class="dotted">|</span>
        <span>Theme by <i>yaming042</i></span>
        
        <!-- <span class="dotted">|</span>
        <span><a href="http://www.beian.miit.gov.cn" target="_blank">豫ICP备17028068号</a></span> -->
    </div>

    <script>
        var APP_ID = '1lDgPz8SjxTtvmbx7wEyRr5K-gzGzoHsz',
            APP_KEY = 'yjGRwyBaWyarq9iIrOOE07zN',
            IS_POST = 'true' === 'true';
    </script>
    
<script src="/js/tg.min.js"></script>

</div>
    </div>


</body>
</html>